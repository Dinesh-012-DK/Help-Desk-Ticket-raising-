{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"
        integrity="sha512-L0Shl7nXXzIlBSUUPpxrokqq4ojqgZFQczTYlGjzONGTDAcLremjwaWv5A+EDLnxhQzY5xUZPWLOLqYRkY0Cbw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">

    <link rel="shortcut icon" style="border-radius: 20px;" href="{% static 'favicon/favicon.ico' %}" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Marcellus&display=swap" rel="stylesheet">
        
</head>

<!--------- Navigation Bar ----------- -->

<body class="d-flex flex-column min-vh-100" style="background-color: rgb(238, 235, 232);font-family: 'Marcellus, serif'; font-weight: 400;
    font-style: normal;" id="font">
    <nav class="navbar navbar-expand-lg px-4 gradient-navbar">
        <img src="{% static 'favicon/favicon.ico' %}" style="border-radius: 50px;" alt="" width="50px" height="50">
        <h3 class="ms-2" style="font-family: 'Marcellus', cursive;font-weight: 400;font-style: normal;">Help Desk</h3>
        <div class="ms-auto ">
            {% if admin %}
            <span class="text-light fs-5">Admin : {{ admin }}</span>

            <button class="btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions"
                aria-controls="offcanvasWithBothOptions"><img src="{% static 'profile.png' %}"
                    width="40px" height="40" style="border-radius: 30px;" alt="">
            </button>

            <button class="btn btn-outline-light btn-sm p-2" data-bs-toggle="modal" data-bs-target="#logoutModal"><i
                    class="fa-solid fa-right-from-bracket me-1" style="font-size: 15px;"></i><span
                    style="font-size: 15px;">Logout</span></button>
            {% endif %}
        </div>
    </nav>

    <!------------------Admin_Profile_Offcanvas-------------------->
    <div class="offcanvas offcanvas-start text-dark" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
        aria-labelledby="offcanvasWithBothOptionsLabel" style="background-color: rgb(238, 235, 232);">

        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel"
                style="color: rgb(17, 5, 187); font-size: 30px; font-weight: bolder ;">
                Admin Profile
            </h5>
            <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
        </div>

        {% if adminshow %}
        <div class="offcanvas-body">
            <div class="d-flex-row p-2 text-center">
                <i class="fa-solid fa-circle-user" style="color: rgb(23, 96, 206); font-size: 130px;"></i>
                <h3 class="mt-2">{{ adminshow.admin_name }}</h3>
            </div>

            <form method="post" action="{% url 'admin_profile_update' %}" class="w-100">
                {% csrf_token %}
                <!-- Admin Name -->
                <div class="form-floating mb-3 w-100">
                    <input type="text" class="form-control" id="adminName" value="{{ adminshow.admin_name }}"
                        placeholder="username" name="admin_name" required>
                    <label for="adminName">Admin Name</label>
                </div>

                <!-- Admin ID -->
                <div class="form-floating mb-4">
                    <input type="text" id="adminId" name="admin_id" value="{{ adminshow.admin_id }}"
                        class="form-control bg-body-tertiary rounded-2" placeholder="Admin ID" data-bs-toggle="tooltip"
                        title="Only Admin Can Update this field" readonly>
                    <label for="adminId">Admin ID</label>
                </div>

                <!-- Admin Email -->
                <div class="form-floating mb-4">
                    <input type="email" id="adminMail" name="admin_email" value="{{ adminshow.email }}"
                        class="form-control bg-body-tertiary rounded-2" placeholder="Admin Email" required>
                    <label for="adminMail">Admin Email</label>
                </div>

                <!-- Password -->
                <div class="form-floating mb-4">
                    <input type="password" id="adminPass" name="password" value="{{ adminshow.password }}"
                        class="form-control bg-body-tertiary rounded-2" placeholder="Password" required>
                    <label for="adminPass">Password</label>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="mt-2 btn btn-primary w-100">
                    <i class="fa-solid fa-user-plus me-2"></i>Update Admin
                </button>
            </form>
        </div>
    </div>
    {% endif %}


    <!-------------- Logout Modal ----------- -->

    <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logoutModalLabel">Confirm Logout</h5>
                    <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">Are you sure you want {{ admin }} to logout?</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-success" data-bs-dismiss="modal">Cancel</button>
                    <a href="{% url 'logout' %}" class="btn btn-outline-danger">Yes, Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!------------ Sidebar -------------->

    <button class="btn btn-secondary toggle-btn ms-2 mt-4" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#staticBackdrop" aria-controls="staticBackdrop">
        <i class="fa-solid fa-bars bar-icon fs-4"></i>
    </button>

    <div class="offcanvas offcanvas-start custom-width" tabindex="-1" id="staticBackdrop"
        aria-labelledby="staticBackdropLabel" style="background-color: rgb(238, 235, 232);">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="staticBackdropLabel"
                style="color: rgb(17, 5, 187); font-size: 30px; font-weight: bolder ;">
                Admin Dashboard</h5>
            <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
        </div>
        <div class="offcanvas-body" style="font-family: 'Gabarito', sans-serif; font-weight: 400;font-style: normal;">
            <!-- <button class="sidebar-btn-custom dashboard" data-target="#dash">
                <h5>DASHBOARD</h5>
            </button> -->
            <button class="sidebar-btn-custom create_admin mt-4" data-target="#admin">
                <h5>CREATE ADMIN</h5>
            </button>
            <button class="sidebar-btn-custom create_agent mt-4" data-target="#agent">
                <h5>CREATE AGENT</h5>
            </button>
            <button class="sidebar-btn-custom create_user mt-4" data-target="#user">
                <h5>CREATE USER</h5>
            </button>
            <button class="sidebar-btn-custom ticket_monitor mt-4" data-target="#ticket">
                <h5>TICKET MONITOR</h5>
            </button>
            <button class="sidebar-btn-custom feedback mt-4" data-target="#feed">
                <h5>FEEDBACK</h5>
            </button>
        </div>
    </div>



    <!----------------Sidebar Toggle Script----------------->

    <main class="flex-grow-1 p-4">
        <!-- <div class="content-section active mt-5" id="dash">
            <h1 class="text-center"
                style="margin-right: 60px; font-size: 35px; color: rgb(17, 5, 187);text-shadow: 2px 2px 4px rgb(238, 149, 207);">
                Dashboard</h1>
            <h2>Dashboard</h2>
            <p>Welcome to the Admin Dashboard. Here you can manage users, agents, and admins.</p>
            <p>Use the sidebar to navigate through different sections.</p>
            <p>Click on the buttons to create new users, agents, or admins.</p>
            <p>Monitor tickets and feedback from the respective sections.</p>
            <p>For any assistance, contact support.</p>
            <p>Enjoy managing your ticketing system!</p>
            <p>Current Admin: {{ admin }}</p>
            <p>Pending Tickets: {{ pending_tickets }}</p>
            <p>Resolved Tickets: {{ resolved_tickets }}</p>
            <p>Feedback Count: {{ feedback_count }}</p>
            <p>Active Users: {{ active_users }}</p>
        </div> -->


        <!--------------------Create Admin Section---------------------->

        <!----------------Admin_Table_data--------------->

        <div class="content-section mt-5" id="admin">
            <h1 class="text-center"
                style="margin-right: 60px; font-size: 35px; color: rgb(17, 5, 187);text-shadow: 2px 2px 4px rgb(238, 149, 207);">
                Admin Table</h1>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-outline-dark crt_btn" data-bs-toggle="modal"
                data-bs-target="#create_admin">CREATE ADMIN</button>
            <table class="table table-hover mt-4 h5" style="margin-left: 8%; width: 80%;">
                <thead class="table-dark">
                    <th class="text-center border">S.No</th>
                    <th class="text-center border">Admin_Id</th>
                    <th class="text-center border">Name</th>
                    <th class="text-center border">Email</th>
                    <th class="text-center border">Password</th>
                    <th class="text-center border">Edit</th>
                    <th class="text-center border">Delete</th>
                </thead>
                <tbody class="table-group-divider">
                    {% if admins %}
                    {% for admins in admins %}
                    <tr>
                        <td class="text-center border">{{ forloop.counter }}</td>
                        <td class="text-center border">{{ admins.admin_id }}</td>
                        <td>{{ admins.admin_name }}</td>
                        <td class="border">{{ admins.email }}</td>
                        <!-- <td class="text-center">{{ admins.password }}</td> -->
                        <td class="text-center">*******</td>
                        <td class="text-center border">
                            <button type="button" class="btn btn-outline-warning btn-sm" data-bs-toggle="modal"
                                data-bs-target="#update_admin{{ admins.id }}">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                        </td>
                        <td class="text-center">
                            <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                                data-bs-target="#delete_admin{{ admins.id }}">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">No Data found</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>



        <!-------------------Create_Admin_Modal--------------------->

        <div class="modal fade" id="create_admin" tabindex="-1" aria-labelledby="createAdminLabel" aria-hidden="true"
            style="margin-top: 7%;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="createAdminLabel">CREATE ADMIN</h1>
                        <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="background-color: rgb(238, 235, 232);">
                        <form action="{% url 'create_admin' %}" method="post">
                            {% csrf_token %}
                            <div class="form-floating mb-3 w-100">
                                <input type="text" class="form-control fs-5" id="adminName" placeholder="username"
                                    name="admin_name">
                                <label for="adminName">Admin Name</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="adminId" placeholder="admin_id"
                                    name="admin_id">
                                <label for="adminId">Admin ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="email" class="form-control" id="adminEmail" placeholder="email"
                                    name="admin_email">
                                <label for="adminEmail">Email</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="password" class="form-control" id="adminPass" placeholder="Password"
                                    name="admin_pass">
                                <label for="adminPass">Password</label>
                            </div>
                            <button type="submit" class="create_btn">SUBMIT</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <!---------------------Update_Admin_Modal--------------------->

        {% for admins in admins %}
        <div class="modal fade" id="update_admin{{ admins.id }}" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true" style="margin-top: 7%;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">UPDATE PROFILE</h1>
                        <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="background-color: rgb(238, 235, 232);">
                        <form action="{% url 'update_admin' admins.id %}" method="post">
                            {% csrf_token %}
                            <div class="form-floating mb-3 w-100">
                                <input type="text" class="form-control" id="adminName" value="{{ admins.admin_name }}"
                                    placeholder="username" name="admin_name" required>
                                <label for="adminName">Admin Name</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="adminId" value="{{ admins.admin_id }}"
                                    placeholder="admin_id" name="admin_id" readonly>
                                <label for="adminId">Admin ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="email" class="form-control" id="adminEmail" value="{{ admins.email }}"
                                    placeholder="email" name="admin_email" required>
                                <label for="adminEmail">Email</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="password" class="form-control" id="adminPass" value=""
                                    placeholder="Password" name="admin_pass" required>
                                <label for="adminPass">Password</label>
                            </div>
                            <button type="submit" class="create_btn">UPDATE</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}


        <!-----------------------Delete_Admin_Modal------------------------->

        {% for admin in admins %}
        <div class="modal fade" id="delete_admin{{ admin.id }}" tabindex="-1" aria-labelledby="deleteModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="POST" action="{% url 'delete_admin' admin.id %}">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteModalLabel">Delete Admin</h5>
                            <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete <span class="fw-bold fs-5 text-danger">
                                {{ admin.admin_name }} ?</span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-success"
                                data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-outline-danger">Yes, Delete</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}



        <!--------------------Create_Agent_Section---------------------->

        <!----------------Agent_Table_data--------------->


        <div class="d-none content-section mt-5" id="agent">
            <h1 class="text-center"
                style="margin-right: 60px; font-size: 35px; color: rgb(17, 5, 187);text-shadow: 2px 2px 4px rgb(238, 149, 207)">
                Agent Table</h1>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-outline-dark crt_btn" data-bs-toggle="modal"
                data-bs-target="#create_agent">
                CREATE AGENT
            </button>
            <table class="table table-hover mt-4 h5" style="margin-left: 8%; width: 80%;">
                <thead class="table-dark">
                    <th class="text-center border">S.No</th>
                    <th class="text-center border">Agent_Id</th>
                    <th class="text-center border">Name</th>
                    <th class="text-center border">Email</th>
                    <th class="text-center border">Password</th>
                    <th class="text-center border">Edit</th>
                    <th class="text-center border">Delete</th>
                </thead>
                <tbody>
                    {% if agents %}
                    {% for agents in agents %}
                    <tr>
                        <td class="text-center border">{{ forloop.counter }}</td>
                        <td class="text-center border">{{ agents.agent_id }}</td>
                        <td class="border">{{ agents.agent_name }}</td>
                        <td class="border">{{ agents.email }}</td>
                        <!-- <td class="text-center">{{ agents.password }}</td> -->
                        <td class="text-center border">*******</td>
                        <td class="text-center border">
                            <button type="button" class="btn btn-outline-warning btn-sm text-center border"
                                data-bs-toggle="modal" data-bs-target="#update_agent{{ agents.id }}">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                        </td>
                        <td class="text-center border">
                            <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                                data-bs-target="#delete_agent{{ agents.id }}">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="7" class="text-center text-muted border">No Data found</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>



        <!-------------------Create_Agent_Modal--------------------->

        <div class="modal fade" id="create_agent" tabindex="-1" aria-labelledby="createAgentLabel" aria-hidden="true">
            <div class="modal-dialog" style="margin-top: 7%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="createAgentLabel">CREATE AGENT</h1>
                        <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="background-color: rgb(238, 235, 232);">
                        <form action="{% url 'create_agent'%}" method="post">
                            {% csrf_token %}
                            <div class="form-floating mb-3 w-100">
                                <input type="text" class="form-control" id="agentName" placeholder="username"
                                    name="agent_name">
                                <label for="agentName">Agent Name</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="agentId" placeholder="agent_id"
                                    name="agent_id">
                                <label for="agentId">Agent ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="email" class="form-control" id="agentEmail" placeholder="email"
                                    name="agent_email">
                                <label for="agentEmail">Email</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="password" class="form-control" id="agentPass" placeholder="Password"
                                    name="agent_pass">
                                <label for="agentPass">Password</label>
                            </div>
                            <button type="submit" class="create_btn">SUBMIT</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <!---------------------Update_Agent_Modal--------------------->


        {% for agents in agents %}
        <div class="modal fade" id="update_agent{{ agents.id }}" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true" style="margin-top: 7%;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">UPDATE AGENT</h1>
                        <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="background-color: rgb(238, 235, 232);">
                        <form action="{% url 'update_agent' agents.id %}" method="post">
                            {% csrf_token %}
                            <div class="form-floating mb-3 w-100">
                                <input type="text" class="form-control" id="agentName" value="{{ agents.agent_name }}"
                                    placeholder="username" name="agent_name" required>
                                <label for="agentName">Agent Name</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="agentId" value="{{ agents.agent_id }}"
                                    placeholder="agent_id" name="agent_id" readonly>
                                <label for="agentId">Agent ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="email" class="form-control" id="agentEmail" value="{{ agents.email }}"
                                    placeholder="email" name="agent_email" required>
                                <label for="agentEmail">Email</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="password" class="form-control" id="agentPass" value=""
                                    placeholder="Password" name="agent_pass" required>
                                <label for="agentPass">Password</label>
                            </div>
                            <button type="submit" class="create_btn">UPDATE</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}


        <!---------------------Delete_Agent_Modal--------------------->

        {% for agent in agents %}
        <div class="modal fade" id="delete_agent{{ agent.id }}" tabindex="-1" aria-labelledby="deleteModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="POST" action=" {% url 'delete_agent' agent.id %}">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteModalLabel">Delete Agent</h5>
                            <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete <span class="fw-bold fs-5 text-danger">
                                {{ agent.agent_name }} ?</span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-success"
                                data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-outline-danger">Yes, Delete</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}



        <!--------------------Create_User_Section---------------------->

        <!----------------User_Table_data--------------->

        <div class="d-none content-section mt-5" id="user">
            <h1 class="text-center"
                style="margin-right: 60px; font-size: 35px; color: rgb(17, 5, 187);text-shadow: 2px 2px 4px rgb(238, 149, 207);">
                User's Table</h1>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-outline-dark crt_btn" data-bs-toggle="modal"
                data-bs-target="#create_user">
                CREATE USER
            </button>
            <div class="table-responsive mt-4">
                <table class="table table-hover h5" style="margin-left: 8%; width: 80%;">
                    <thead class="table-dark">
                        <tr>
                            <th class="text-center border">S.No</th>
                            <th class="text-center border">Emp_Id</th>
                            <th class="text-center border">Name</th>
                            <th class="text-center border">Email</th>
                            <th class="text-center border">System_ID</th>
                            <th class="text-center border">Password</th>
                            <th class="text-center border">Edit</th>
                            <th class="text-center border">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if users %}
                        {% for users in users %}
                        <tr>
                            <td class="text-center border">{{ forloop.counter }}</td>
                            <td class="text-center border">{{ users.user_id }}</td>
                            <td class="border">{{ users.user_name }}</td>
                            <td class="border">{{ users.email }}</td>
                            <td class="text-center border">{{ users.sys_id }}</td>
                            <td class="text-center border">*******</td>
                            <td class="text-center border">
                                <button type="button" class="btn btn-outline-warning btn-sm" data-bs-toggle="modal"
                                    data-bs-target="#update_user{{ users.id }}">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                            </td>
                            <td class="text-center border">
                                <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                                    data-bs-target="#delete_user{{ users.id }}">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="8" class="text-center text-muted border">No Data found</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>


        <!---------------------Create_User_Modal--------------------->

        <div class="modal fade" id="create_user" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"
            style="margin-top: 7%;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">CREATE USER</h1>
                        <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="background-color: rgb(238, 235, 232);">
                        <form class="m-auto" action="{% url 'create_user' %}" method="post">
                            {% csrf_token %}
                            <div class="form-floating mb-3 w-100">
                                <input type="text" class="form-control" id="userName" placeholder="User Name"
                                    name="user_name">
                                <label for="userName">User Name</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="userId" placeholder="ID" name="user_id"
                                    min="1">
                                <label for="userId">User ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="email" class="form-control" id="userEmail" placeholder="email"
                                    name="user_email">
                                <label for="userEmail">Email</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="userSysId" placeholder="System ID"
                                    name="system_id" min="1">
                                <label for="userSysId">System ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="password" class="form-control" id="userPass" placeholder="Password"
                                    name="user_pass">
                                <label for="userPass">Password</label>
                            </div>
                            <button type="submit" class="create_btn">SUBMIT</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <!---------------------Update_User_Modal--------------------->

        {% for users in users %}
        <div class="modal fade" id="update_user{{ users.id }}" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true" style="margin-top: 7%;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">UPDATE USER</h1>
                        <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="background-color: rgb(238, 235, 232);">
                        <form class="m-auto" action="{% url 'update_user' users.id %}" method="post">
                            {% csrf_token %}
                            <div class="form-floating mb-3 w-100">
                                <input type="text" class="form-control" id="userName" value="{{ users.user_name }}"
                                    placeholder="email" name="user_name" required>
                                <label for="userEmail">User Name</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="userId" value="{{ users.user_id }}"
                                    placeholder="email" name="user_id" readonly>
                                <label for="userId">User ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="email" class="form-control" id="userEmail" value="{{ users.email }}"
                                    placeholder="email" name="user_email" required>
                                <label for="userEmail">Email</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="number" class="form-control" id="userSysId" value="{{ users.sys_id }}"
                                    placeholder="email" name="user_sys_id" readonly>
                                <label for="userSysId">System ID</label>
                            </div>
                            <div class="form-floating mb-3 w-100">
                                <input type="password" class="form-control" id="userPass" value="" placeholder="email"
                                    name="user_pass" required>
                                <label for="userPass">Password</label>
                            </div>
                            <button type="submit" class="create_btn">UPDATE</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}


        <!---------------------Delete_Users_Modal--------------------->

        {% for user in users %}
        <div class="modal fade" id="delete_user{{ user.id }}" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="POST" action=" {% url 'delete_user' user.id %}">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteModalLabel">Delete Agent</h5>
                            <button type="button" class="btn btn-danger btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete <span class="fw-bold fs-5 text-danger">
                                {{ user.user_name }} ?</span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-success"
                                data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-outline-danger">Yes, Delete</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}



        <!------------------Ticket Monitor Section-------------------->
        <div class="d-none content-section mt-5" id="ticket">
            <h1 class="text-center"
                style="font-size: 35px; color: rgb(17, 5, 187); text-shadow: 2px 2px 4px rgb(238, 149, 207);">
                Tickets Monitor
            </h1>

            <div class="table-responsive mt-4">
                <table class="table table-hover h5" style="margin-left: 8%; width: 80%;">
                    <thead class="table-dark text-center">
                        <tr>
                            <th class="border">S.No</th>
                            <th class="border">Title</th>
                            <th class="border">Raised By</th>
                            <th class="border">Status</th>
                            <th class="border">Assigned Agent</th>
                            <th class="border">Category</th>
                            <th class="border">Created At</th>
                            <th class="border">Action</th>
                        </tr>
                    </thead>
                    <tbody class="border text-center">
                        {% if tickets %}
                        {% for ticket in tickets %}
                        <tr>
                            <td class="border">{{ forloop.counter }}</td>
                            <td class="border">{{ ticket.title }}</td>
                            <td class="border">{{ ticket.user.user_name }}</td>
                            <td class="border">
                                {% if ticket.status == "Open" %}
                                <span class="badge bg-warning text-dark">Open</span>
                                {% elif ticket.status == "In Progress" %}
                                <span class="badge bg-primary">In Progress</span>
                                {% elif ticket.status == "Resolved" %}
                                <span class="badge bg-success">Resolved</span>
                                {% elif ticket.status == "Closed" %}
                                <span class="badge bg-secondary">Closed</span>
                                {% else %}
                                <span class="badge bg-light text-dark">{{ ticket.status }}</span>
                                {% endif %}
                            </td>
                            <td class="border">{{ ticket.assigned_agent.agent_name|default:"Unassigned" }}</td>
                            <td class="border">{{ ticket.category }}</td>
                            <td class="border">{{ ticket.created_at }}</td>
                            <td class="border">
                                {% if ticket.status == "Closed" %}
                                <button type="button" disabled class="btn btn-success assign-btn"
                                    data-ticket-id="{{ ticket.id }}" data-bs-toggle="modal"
                                    data-bs-target="#assignTicketModal">
                                    Assign
                                </button>
                                {% else %}
                                <button type="button" class="btn btn-outline-success assign-btn"
                                    data-ticket-id="{{ ticket.id }}" data-bs-toggle="modal"
                                    data-bs-target="#assignTicketModal{{ ticket.id }}">
                                    Assign
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="8" class="text-muted">No tickets found.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>


        <!-- Assign Ticket Modal -->
        {% if tickets %}
        {% for ticket in tickets %}
        <div class="modal fade" id="assignTicketModal{{ ticket.id }}" tabindex="-1"
            aria-labelledby="assignTicketModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="post" id="assignTicketForm" action="{% url 'assign_ticket' ticket.id %}">
                        {% csrf_token %}

                        <div class="modal-header">
                            <h5 class="modal-title" id="assignTicketModalLabel">Assign Ticket</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <label for="agent">Select Agent:</label>
                            <select name="assign_agent" class="form-control mb-3" required>
                                {% for agent in agents %}
                                <option value="{{ agent }}">{{ agent.agent_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-outline-success">Assign Agent</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
        {% endif %}

        <!------------------Feedback Section-------------------->
        <div class="d-none content-section mt-5" id="feed">
            <h1 class="text-center"
                style="margin-right: 60px; font-size: 35px; color: rgb(17, 5, 187);text-shadow: 2px 2px 4px rgb(238, 149, 207);">
                Feedback</h1>
            <table class="table table-hover mt-4 h5" style="margin-left: 10%; width: 80%;">
                <thead class="table-dark text-center">
                    <tr>
                        <th class="border">S.No</th>
                        <th class="border">User</th>
                        <th class="border">Rating</th>
                        <th class="border">Comment</th>
                        <th class="border">Submitted At</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    {% for f in feedbacks %}
                    <tr>
                        <td class="border">{{ forloop.counter }}</td>
                        <td class="border">{{ f.user.user_name }}</td>
                        <td class="border">
                            {% if f.rating == 5 %}
                            <span class="badge bg-success">★ {{ f.rating }}</span>
                            {% elif f.rating == 4 %}
                            <span class="badge bg-primary">★ {{ f.rating }}</span>
                            {% elif f.rating == 3 %}
                            <span class="badge bg-warning text-dark">★ {{ f.rating }}</span>
                            {% elif f.rating == 2 %}
                            <span class="badge bg-info text-dark">★ {{ f.rating }}</span>
                            {% elif f.rating == 1 %}
                            <span class="badge bg-danger">★ {{ f.rating }}</span>
                            {% else %}
                            <span class="badge bg-secondary">No Rating</span>
                            {% endif %}
                        </td class="border">

                        <td class="border">{{ f.comment }}</td>
                        <td class="border">{{ f.created_at|date:"M d, Y h:i A" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">No feedback submitted yet.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>


    <!------------------_Login_Message_-------------------->

    {% if messages %}
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                {% for msg in messages %}
                <div
                    class="modal-header {% if msg.tags == 'success' %}bg-success text-white{% elif msg.tags == 'error' %}bg-danger text-white{% endif %}">
                    <h5 class="modal-title" id="messageModalLabel">
                        {% if msg.tags == 'success' %}Success{% elif msg.tags == 'error' %}Error{% endif %}
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">{{ msg }}</div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-show message modal if messages exist
        document.addEventListener('DOMContentLoaded', function () {
            const modalEl = document.getElementById('messageModal');
            if (modalEl) {
                const modal = new bootstrap.Modal(modalEl);
                modal.show();
            }

            // Sidebar button click functionality
            const sidebarButtons = document.querySelectorAll(".sidebar-btn-custom");
            const contentSections = document.querySelectorAll(".content-section");

            sidebarButtons.forEach(button => {
                button.addEventListener("click", () => {
                    const targetId = button.getAttribute("data-target").replace('#', '');
                    contentSections.forEach(section => section.classList.add("d-none"));
                    sidebarButtons.forEach(btn => btn.classList.remove("active"));

                    // Show the target section
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.remove("d-none");
                        targetSection.scrollIntoView({ behavior: "smooth" });
                    }
                    button.classList.add("active");
                });
            });
            // Auto-click the first sidebar button to show its content
            if (sidebarButtons.length > 0) {
                sidebarButtons[0].click();
            }
        });
    </script>
</body>

</html>